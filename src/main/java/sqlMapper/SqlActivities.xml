<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.qike.common.Sqlinter.SqlActivitiesOperation">
 <!-- 根据id查找活动 SqlActivities -->
	<select id="getSqlActivitiesById" parameterType="SqlActivities" resultMap="resultListSqlActivities">
		select
		`ac-id`,`ac-name`,`ac-photo`,`o-name`,`ac-stime`,`ac-etime`,`ac-detail`,`ac-sponsor`,`ac-state`,`ac-address`
		from activities where activities.`ac-id`=#{id}
	</select>
	
	<resultMap type="SqlActivities" id="resultListSqlActivities">
		<id column="ac-id" property="id" />
		<result column="ac-name" property="name" />
		<result column="o-id" property="o_id" />
		<result column="ac-photo" property="photo" />
		<result column="ac-stime" property="stime" />
		<result column="ac-etime" property="etime" />
		<result column="ac-detail" property="detail" /> 
		<result column="ac-sponsor" property="sponsor" />
		<result column="ac-state" property="state" />
		<result column="ac-signtime" property="signtime"/>
		<result column="ac-endsigntime" property="endsigntime"/>
		<result column="ac-address" property="address"/>
	</resultMap>
<!-- 添加活动 -->
	<insert id="createActivities" parameterType="SqlActivities" useGeneratedKeys="true"
		keyProperty="id">
		insert into activities(`ac-name`,`o-id`,`ac-signtime`,`ac-endsigntime`,`ac-stime`,`ac-etime`,`ac-detail`,`ac-photo`,`ac-sponser`,`st-state`,`ac-engage`,`ac-address`)
		values (#{name},#{o_id},#{signtime},#{endsigntime},#{stime},#{etime},#{detail},#{photo},#{sponsor},10,'[]',#{address})
		</insert>
<!-- 参加活动 -->
	<update id="engageActivities">
	 update activities set `ac-engage`=JSON_MERGE(`ac-engage`,#{student_id,jdbcType=VARCHAR}) where `ac-id`=#{activities_id,jdbcType=BIGINT}
	</update>
<!-- 退出已经参加的活动 -->
	<update id="cancelEngage">
		update activities set `ac-engage`=replace(`ac-engage`,#{student_id,jdbcType=VARCHAR},'')where `ac-id`=#{activities_id,jdbcType=BIGINT}
	</update>
<!-- 删除活动 -->
	<delete id="deleteActivities" parameterType="SqlActivities">
	delete from activities where `ac-id`=#{id}	
	</delete>
	<!-- 审批活动 -->
	<update id="checkActivities">
	update activities set `st-state`=#{state} where `ac-id`=#{id}
	</update>
</mapper>